/**
* react-masked-field 0.1.0
*
* Copyright (c) 2015 ZenPayroll
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.MaskedField=t()}}(function(){return function t(e,n,r){function s(i,a){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[i]={exports:{}};e[i][0].call(h.exports,function(t){var n=e[i][1][t];return s(n?n:t)},h,h.exports,t,e,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(t,e,n){"use strict";var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},s=(window?window.React:null)||t("react"),o=t("./SelectionUtils"),i=o.getSelection,a=o.setSelection,u=t("./formatValidator"),l={9:/\d/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/},h=s.createClass({displayName:"MaskedField",propTypes:{mask:s.PropTypes.string,format:u,translations:s.PropTypes.object,value:s.PropTypes.string,onChange:s.PropTypes.func,onKeyDown:s.PropTypes.func,onComplete:s.PropTypes.func,onFocus:s.PropTypes.func,valueLink:s.PropTypes.object},getDefaultProps:function(){return{format:"_"}},getInitialState:function(){if(null==this.props.mask)return null;this._buffer=[];for(var t=0;t<this.props.mask.length;++t)this._getPattern(t)?(null==this._firstNonMaskIdx&&(this._firstNonMaskIdx=t),this._buffer.push(this._getFormatChar(t))):this._buffer.push(this.props.mask[t]);return{value:this._maskedValue(this._getPropsValue()||"")}},componentDidUpdate:function(){null!=this._cursorPos&&this._setSelection(this._cursorPos)},componentDidMount:function(){var t=this._getPropsValue();null!=this.props.mask&&null!=t&&this.state.value!==t&&this._callOnChange(this.state.value)},render:function(){var t=void 0;return t=null!=this.props.mask?{onChange:this._handleChange,onKeyDown:this._handleKeyDown,onFocus:this._handleFocus,value:this.state.value,valueLink:null}:{},s.createElement("input",r({},this.props,t))},_getSelection:function(){if(this.isMounted())return i(this.getDOMNode());var t=(this._getPropsValue()||"").length;return{start:t,end:t}},_setSelection:function(t){var e=void 0===arguments[1]?t:arguments[1];return function(){a(this.getDOMNode(),t,e)}.apply(this,arguments)},_getPropsValue:function(){return null!=this.props.valueLink?this.props.valueLink.value:this.props.value},_getPattern:function(t){var e=this.props.mask[t],n=this.props.translations?this.props.translations[e]:null;return n||l[e]},_getFormatChar:function(t){return t=t<this.props.format.length?t:0,this.props.format[t]},_resetBuffer:function(t,e){for(var n=t;e>n;++n)this._getPattern(n)&&(this._buffer[n]=this._getFormatChar(n))},_nextNonMaskIdx:function(t){for(var e=t+1;e<this.props.mask.length;++e)if(this._getPattern(e))return e},_prevNonMaskIdx:function(t){for(var e=t-1;e>=0;--e)if(this._getPattern(e))return e},_callOnChange:function(t){null!=this.props.valueLink?this.props.valueLink.requestChange(t):this.props.onChange&&this.props.onChange({target:{value:t}})},_callOnComplete:function(t){if(this.props.onComplete){for(var e=0;e<this.props.mask.length;++e)if(this._getPattern(e)&&this._buffer[e]===this._getFormatChar(e))return;this.props.onComplete(t)}},_setValue:function(t){t!==this.state.value&&this._callOnChange(t),this.setState({value:t})},_handleFocus:function(t){var e=this;setTimeout(function(){e._setSelection(e._cursorPos)},0),this.props.onFocus&&this.props.onFocus(t)},_handleKeyDown:function(t){if("Backspace"===t.key||"Delete"===t.key){var e=this._getSelection(),n=e.start,r=e.end;n===r&&(n="Delete"===t.key?this._nextNonMaskIdx(n-1):this._prevNonMaskIdx(n),r=this._nextNonMaskIdx(n));var s=void 0,o=this._getPattern(n);o&&o.test(this._buffer[r])?s=this._maskedValue(this.state.value.substring(r),n):(this._resetBuffer(n,r),s=this._buffer.join("")),this._setValue(s),this._cursorPos=Math.max(n,this._firstNonMaskIdx),t.preventDefault()}this.props.onKeyDown&&this.props.onKeyDown(t)},_handleChange:function(t){var e=this._maskedValue(t.target.value);this._setValue(e),this._callOnComplete(e)},_maskedValue:function(t){for(var e=void 0===arguments[1]?0:arguments[1],n=this._cursorPos=this._getSelection().start,r=e,s=0;r<this.props.mask.length;++r){var o=this._getPattern(r);if(o){for(this._buffer[r]=this._getFormatChar(r);s<t.length;){var i=t[s++];if(o.test(i)){this._buffer[r]=i;break}this._cursorPos>r&&this._cursorPos--}if(s>=t.length){this._resetBuffer(r+1,this.props.mask.length);break}}else n>=s&&this._cursorPos++,this._buffer[r]===t[s]&&s++}return this._buffer.join("")}});e.exports=h},{"./SelectionUtils":2,"./formatValidator":3,react:"react"}],2:[function(t,e,n){"use strict";e.exports={getSelection:function(t){var e=void 0,n=void 0;if(null!=t.setSelectionRange)e=t.selectionStart,n=t.selectionEnd;else{var r=document.selection.createRange();e=0-r.duplicate().moveStart("character",-1e5),n=e+r.text.length}return{start:e,end:n}},setSelection:function(t,e,n){if(null!=t.setSelectionRange)t.setSelectionRange(e,n);else{var r=t.createTextRange();r.collapse(!0),r.moveEnd("character",e),r.moveStart("character",n),r.select()}}}},{}],3:[function(t,e,n){"use strict";var r=(window?window.React:null)||t("react");e.exports=function(t,e,n){var s=r.PropTypes.string.apply(null,arguments);if(null===s&&null!=t.mask&&null!=t.format&&1!==t.format.length&&t.format.length!==t.mask.length){var o="Invalid prop `"+e+"` supplied to `"+n+"`, length must be 1 or match the length of prop `mask`.";s=new Error(o)}return s}},{react:"react"}]},{},[1])(1)});